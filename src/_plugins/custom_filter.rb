module CustomFilter
  Categories = {
    'playlist' => 'プレイリスト',
    'note'     => '雑記',
  }

  ReleaseYears = {
    '2029'  => '2029年',
    '2028'  => '2028年',
    '2027'  => '2027年',
    '2026'  => '2026年',
    '2025'  => '2025年',
    '2024'  => '2024年',
    '2023'  => '2023年',
    '2022'  => '2022年',
    '2021'  => '2021年',
    '2020'  => '2020年',
    '2019'  => '2019年',
    '2018'  => '2018年',
    '2017'  => '2017年',
    '2016'  => '2016年',
    '2015'  => '2015年',
    '2020s' => '2020年代',
    '2010s' => '2010年代',
    '2000s' => '2000年代',
    '1990s' => '1990年代',
    '1980s' => '1980年代',
    '1970s' => '1970年代',
    '1960s' => '1960年代',
  }

  Genres = {
    'guitar-pop'   => 'ネオアコ／ギターポップ',
    'anime'        => 'アニメ',
    'idle'         => 'アイドル',
    'k-pop'        => 'K-Pop',
    'j-pop'        => 'J-Pop',
    'j-rock'       => 'J-Rock',
    'pop'          => 'Pop',
    'rock'         => 'Rock',
  }

  Artists = {
    '26jino-masquerade'            => '26時のマスカレイド',
    'absolute-area'                => 'Absolute area',
    'advantage-lucy'               => 'advantage Lucy',
    'aimer'                        => 'Aimer',
    'air'                          => 'AIR',
    'airflip'                      => 'AIRFLIP',
    'akaiko-en'                    => '赤い公園',
    'akishibu-project'             => 'アキシブproject',
    'alan-walker'                  => 'Alan Walker',
    'alex-lahey'                   => 'アレックス・レイヒー',
    'alia'                         => 'AliA',
    'amelie'                       => 'Amelie',    
    'andymori'                     => 'andymori',
    'angels-and-airwaves'          => 'エンジェルズ・アンド・エアウェーヴズ',
    'anna-of-the-north'            => 'Anna of the North',
    'appare-harajyuku'             => '天晴れ!原宿',
    'aprilblue'                    => 'エイプリルブルー',
    'arty'                         => 'アーティ、マティス&サドコ',
    'aztec-camera'                 => 'アズテック・カメラ',
    'baby-kiy'                     => 'Baby Kiy',
    'bad-suns'                     => 'Bad Suns',
    'band-ja-nai-mon'              => 'バンドじゃないもん !',
    'barbee-boys'                  => 'バービーボーイズ',
    'basi'                         => 'BASI',
    'bbhf'                         => 'BBHF',
    'belle-and-sebastian'          => 'ベル・アンド・セバスチャン',
    'bis'                          => 'BiS',
    'bish'                         => 'BiSH',
    'blackpink'                    => 'BLACKPINK',
    'blink-182'                    => 'blink-182',
    'bol4'                         => 'Bolbbalgan4',
    'boowy'                        => 'BOØWY',
    'braeves'                      => 'BRAEVES',
    'buck-tick'                    => 'BUCK-TICK',
    'camera-obscura'               => 'Camera Obscura',
    'carly-rae-jepsen'             => 'カーリー・レイ・ジェプセン',
    'caroline-kole'                => 'Caroline Kole',
    'catfish-and-the-bottlemen'    => 'Catfish and the Bottlemen',
    'chanmina'                     => 'ちゃんみな',
    'chara'                        => 'Chara',
    'chiaki-ito'                   => '伊藤千晃',
    'chiaki-sato'                  => '佐藤千亜妃',
    'chico'                        => 'CHiCO',
    'complex'                      => 'COMPLEX',
    'cornelius'                    => 'Cornelius',
    'culenasm'                     => 'クレナズム',
    'cure'                         => 'ザ・キュアー',
    'cynhn'                        => 'CYNHN',
    'daoko'                        => 'DAOKO',
    'def-tech'                     => 'Def Tech',
    'dubstar'                      => 'dubstar',
    'dutch-criminal-record'        => 'Dutch Criminal Record',
    'dygl'                         => 'DYGL',
    'eikichi-yazawa'               => '矢沢永吉',
    'eill'                         => 'eill',
    'el-friede'                    => 'エルフリーデ',
    'end-of-the-world'             => 'End of the World',
    'equal-love'                   => '=LOVE',
    'eri-nitta'                    => '新田恵利',
    'eve'                          => 'Eve',
    'faith'                        => 'FAITH',
    'farruko'                      => 'Farruko',
    'fhana'                        => 'fhána',
    'flipper-s-guitar'             => 'FLIPPER’S GUITAR',
    'flor'                         => 'Flor',
    'flowback'                     => 'FlowBack',
    'frank-and-walters'            => 'The Frank & Walters',
    'fripps-and-fripps'            => 'Fripps & Fripps',
    'fukurouzu'                    => 'ふくろうず',
    'galantis-&-yellow-claw'       => 'ギャランティス & イエロー・クロウ',
    'galileo-galilei'              => 'Galileo Galilei',
    'gen-hoshino'                  => '星野源',
    'genic'                        => 'GENIC',
    'gomes-the-hitman'             => 'GOMES THE HITMAN',
    'gwsn'                         => 'GWSN',
    'hag'                          => 'H△G',
    'halcali'                      => 'HALCALI',
    'haruka-fukuhara'              => '福原 遥',
    'have-a-nice-day-'             => 'Have a Nice Day!',
    'heavenstamp'                  => 'Heavenstamp',
    'hellogoodbye'                 => 'ハローグッバイ',
    'hideki-kaji'                  => 'カジヒデキ',
    'hitomi'                       => 'hitomi',
    'honeyworks'                   => 'HoneyWorks',
    'hot-dog-cat'                  => 'HOT DOG CAT',
    'huwie-ishizaki'               => '石崎ひゅーい',
    'ice'                          => 'ICE',
    'in-sist'                      => '韻シスト',
    'ingrid-andress'               => 'Ingrid Andress',
    'ingrid-michaelson'            => 'Ingrid Michaelson',
    'innosent-in-formal'           => 'INNOSENT in FORMAL',
    'inori-minase'                 => '水瀬いのり',
    'ivvy'                         => 'IVVY',
    'iz-one'                       => 'IZ*ONE',
    'jitterin-jinn'                => 'ジッタリン・ジン',
    'judy-and-mary'                => 'JUDY AND MARY',
    'jureniwa'                     => 'ユレニワ',
    'kahimi-karie'                 => 'カヒミ・カリィ',
    'kai-band'                     => '甲斐バンド',
    'kamin'                        => 'Kamin',
    'kamiyado'                     => '神宿',
    'kana-boon'                    => 'KANA-BOON',
    'karin-'                       => 'Karin.',
    'katy-perry'                   => 'ケイティ・ペリー',
    'kazunobu-mineta'              => '峯田和伸',
    'kelly-clarkson'               => 'ケリー・クラークソン',
    'kenji-ozawa'                  => '小沢健二',
    'king-gnu'                     => 'King Gnu',
    'kreva'                        => 'KREVA',
    'la-s'                         => 'ラーズ',
    'lama'                         => 'LAMA',
    'lindberg'                     => 'LINDBERG',
    'lisa'                         => 'LiSA',
    'luby-sparks'                  => 'Luby Sparks',
    'lucy-daydream'                => 'Lucy Daydream',
    'm-flo'                        => 'm-flo',
    'madamitakotononaisekai'       => 'まだ見たことのないセカイ',
    'magical-punchline'            => 'マジカル・パンチライン',
    'maneki-kecak'                 => 'まねきケチャ',
    'mao-abe'                      => '阿部真央',
    'mao-sasagawa'                 => '笹川真生',
    'mari-iijima'                  => '飯島真理',
    'mariya-takeuchi'              => '竹内まりや',
    'marshmello'                   => 'Marshmello',
    'martin-garrix'                => 'Martin Garrix',
    'mega-shinnosuke'              => 'Mega Shinnosuke',
    'meghan-trainor'               => 'メーガン・トレイナー',
    'mesto'                        => 'MESTO',
    'mewhan'                       => 'みゆはん',
    'middle-kids'                  => 'Middle Kids',
    'mii'                          => 'Mii',
    'mimimememimi'                 => 'みみめめMIMI',
    'minami'                       => '美波',
    'misako-uno'                   => '宇野実彩子',
    'moso-calibration'             => '妄想キャリブレーション',
    'motoharu-sano'                => '佐野 元春',
    'muse'                         => 'μ’s',
    'my-little-lover'              => 'My Little Lover',
    'neck-deep'                    => 'Neck Deep',
    'nerd-magnet'                  => 'ナードマグネット',
    'newspeak'                     => 'Newspeak',
    'night-cafe'                   => 'The Night Café',
    'niji-no-conquistador'         => '虹のコンキスタドール',
    'nijisanji'                    => 'にじさんじ',
    'nitro-microphone-underground' => 'NITRO MICROPHONE UNDERGROUND',
    'nogizaka46'                   => '乃木坂46',
    'northern-portrait'            => 'Northern Portrait',
    'not-equal-me'                 => '≠ME',
    'nujabes'                      => 'Nujabes',
    'offcourse'                    => 'オフコース',
    'official-hige-dandism'        => 'Official髭男dism',
    'ohzora-kimishima'             => '君島大空',
    'one-ok-rock'                  => 'ONE OK ROCK',
    'onyanko-club'                 => 'おニャン子クラブ',
    'original-love'                => 'ORIGINAL LOVE',
    'ounterfeit-'                  => 'OUNTERFEIT.',
    'pains-of-being-pure-at-heart' => 'The Pains of Being Pure At Heart',
    'pale-spectres'                => 'Pale Spectres',
    'panda-1-2'                    => 'PANDA 1/2',
    'park-bom'                     => 'パク・ボム',
    'park-ji-hoon'                 => 'PARK JI HOON',
    'peggies'                      => 'the peggies',
    'pelican-fanclub'              => 'PELICAN FANCLUB',
    'penguin-research'             => 'PENGUIN RESEARCH',
    'personz'                      => 'PERSONZ',
    'phoenix'                      => 'フェニックス',
    'pimm-s'                       => 'Pimm\'s',
    'polkadot-stingray'            => 'ポルカドットスティングレイ',
    'polysics'                     => 'POLYSICS',
    'post-malone'                  => 'ポスト・マローン',
    'princess-princess'            => 'プリンセス プリンセス',
    'psy-s'                        => 'PSY・S',
    'pup'                          => 'PUP',
    'raise-a-suilen'               => 'RAISE A SUILEN',
    'regrettes'                    => 'The Regrettes',
    'rei-yasuda'                   => '安田 レイ',
    'reol'                         => 'Reol',
    'reona'                        => 'ReoNa',
    'retro-video-club'             => 'Retro Video Club',
    'ride'                         => 'ライド',
    'ringo-shiina'                 => '椎名林檎',
    'ringomusume'                  => 'RINGOMUSUME(りんご娘)',
    'rinu'                         => '莉犬',
    'rip-slyme'                    => 'RIP SLYME',
    'riscas'                       => 'Riscas',
    'round-table'                  => 'ROUND TABLE',
    's-i-s'                        => 'S.I.S',
    'sabrina-carpenter'            => 'サブリナ・カーペンター',
    'sam-fender'                   => 'サム・フェンダー',
    'sambassadeur'                 => 'Sambassadeur',
    'sana'                         => 'sana',
    'saturday'                     => 'SATURDAY',
    'say-la'                       => 'SAY-LA',
    'sayaka-kanda'                 => '神田沙也加',
    'sayuri-kokusho'               => '国生さゆり',
    'schadaraparr'                 => 'スチャダラパー',
    'seiko-matsuda'                => '松田 聖子',
    'seira-kariya'                 => '仮谷 せいら',
    'sekai-no-owari'               => 'SEKAI NO OWARI',
    'seventeen'                    => 'SEVENTEEN',
    'shachi'                       => 'SHACHI',
    'she-s'                        => 'SHE\'S',
    'sheppard'                     => 'Sheppard',
    'shes-gone'                    => 'the shes gone',
    'shiritsu-ebisu-chugaku'       => '私立恵比寿中学',
    'sigrid'                       => 'Sigrid',
    'sinsei-covergirls'            => '新生CoverGirls',
    'ske48'                        => 'SKE48',
    'smiths'                       => 'ザ・スミス',
    'sol'                          => 'SOL',
    'soleil'                       => 'SOLEIL',
    'sora-amemiya'                 => '雨宮天',
    'sorane'                       => '空音',
    'soutaiseiriron'               => '相対性理論',
    'spitz'                        => 'スピッツ',
    'star-tropics'                 => 'Star Tropics',
    'steady-and-co-'               => 'STEADY&CO.',
    'stone-roses'                  => 'ザ・ストーン・ローゼズ',
    'suga-es'                      => 'suga/es',
    'sundays'                      => 'The Sundays',
    'sunny-day-service'            => 'サニーデイ・サービス',
    'supercar'                     => 'スーパーカー',
    'supercell'                    => 'supercell',
    'superfriends'                 => 'Superfriends',
    'susan-cagle'                  => 'Susan Cagle',
    'tahiti-80'                    => 'Tahiti 80',
    'tebasaki-sensation'           => '手羽先センセーション',
    'teto'                         => 'teto',
    'tfg'                          => 'TFG',
    'theme-park-girl'              => 'テーマパークガール',
    'those-dancing-days'           => 'Those Dancing Days',
    'tiffany-young'                => 'ティファニー・ヤング',
    'tm-network'                   => 'TM NETWORK',
    'tokimeki-sendenbu'            => 'ときめき♡宣伝部',
    'tokyo-girls-style'            => '東京女子流',
    'tokyo-incidents'              => '東京事変',
    'trashcan-sinatras'            => 'トラッシュ・キャン・シナトラズ',
    'trf'                          => 'TRF',
    'trysail'                      => 'TrySail',
    'twice'                        => 'TWICE',
    'two-door-cinema-club'         => 'トゥー・ドア・シネマ・クラブ',
    'up-beat'                      => 'UP-BEAT',
    'vid-the-kid'                  => 'Vid Thë Kid',
    'vivid-undress'                => 'vivid undress',
    'wanima'                       => 'WANIMA',
    'wasureranneyo'                => '忘れらんねえよ',
    'westlife'                     => 'ウエストライフ',
    'whoops'                       => 'The Whoops',
    'winking-owl'                  => 'The Winking Owl',
    'yasuko-omori'                 => '大森靖子',
    'yogee-new-waves'              => 'Yogee New Waves',
    'yoshiyuki-ohsawa'             => '大澤誉志幸',
    'yuka-kitahara'                => '北原ゆか',
    'yuki-saito'                   => '斉藤由貴',
    'yumemiru-adolescence'         => '夢みるアドレセンス',
    'yumi-matsutoya'               => '松任谷由実',
    'yutaka-ozaki'                 => '尾崎 豊',
    'zeebra'                       => 'Zeebra',
    'ziggy'                        => 'ZIGGY',
    'zoc'                          => 'ZOC',
  }

  def category_tags(object)
    select_tags(object, Categories)
  end

  def release_year_tags(object)
    select_tags(object, ReleaseYears)
  end

  def genre_tags(object)
    select_tags(object, Genres)
  end

  def artist_tags(object)
    # select_tags(object, Artists)
    tags = []
    Artists.values.sort.each do |v|
      h = Artists.find { |o| o[1] == v }
      tag = object[:tags]&.find { |t| t[0].to_s.downcase == h[0].to_s.downcase }
      tags << tag unless tag.nil?
    end
    tags
  end

  def select_tags(object, target)
    tags = []
    target.keys.each do |k|
      tag = object[:tags]&.find { |v| v[0].to_s.downcase == k.to_s.downcase }
      tags << tag unless tag.nil?
    end
    tags
  end

  def contains_tags(tags, target)
    tags.map { |v| v.to_s.downcase }.include?(target.to_s.downcase)
  end

  def category_tag?(title)
    hash = parse_title(title)
    Categories.keys.map(&:to_s.downcase).include?(hash[:name].to_s.downcase)
  end

  def release_year_tag?(title)
    hash = parse_title(title)
    ReleaseYears.keys.map(&:to_s.downcase).include?(hash[:name].to_s.downcase)
  end

  def genre_tag?(title)
    hash = parse_title(title)
    Genres.keys.map(&:to_s.downcase).include?(hash[:name].to_s.downcase)
  end

  def artist_tag?(title)
    hash = parse_title(title)
    Artists.keys.map(&:to_s.downcase).include?(hash[:name].to_s.downcase)
  end

  def tag_label(title)
    return category_label(title)     if category_tag?(title)
    return release_year_label(title) if release_year_tag?(title)
    return genre_label(title)        if genre_tag?(title)
    return artist_label(title)       if artist_tag?(title)

    title
  end

  def category_label(title)
    hash = parse_title(title)
    "#{Categories[hash[:name]] || hash[:name]}#{hash[:page]}"
  end

  def release_year_label(title)
    hash = parse_title(title)
    "#{ReleaseYears[hash[:name]] || hash[:name]}#{hash[:page]}"
  end

  def genre_label(title)
    hash = parse_title(title)
    "#{Genres[hash[:name]] || hash[:name]}#{hash[:page]}"
  end

  def artist_label(title)
    hash = parse_title(title)
    "#{Artists[hash[:name]] || hash[:name]}#{hash[:page]}"
  end

  def parse_title(title)
    matched = title.to_s.match(/^(.*)( - [\d]+ \/ [\d]+)$/)
    if matched
      name = matched[1]
      page = matched[2]
    else
      name = title.to_s
      page = ''
    end
    {
      name: name,
      page: page,
    }
  end

  def category_badge(tag)
    <<~EOS
      <span class="badge badge-secondary">
        #{category_label(tag)}
      </span>
    EOS
  end

  def release_year_badge(tag)
    <<~EOS
      <span class="badge badge-secondary">
        #{release_year_label(tag)}
      </span>
    EOS
  end

  def genre_badge(tag)
    <<~EOS
      <span class="badge badge-primary">
        #{genre_label(tag)}
      </span>
    EOS
  end

  def artist_badge(tag)
    <<~EOS
      <span class="badge badge-success">
        #{artist_label(tag)}
      </span>
    EOS
  end

  def category_button(tag)
    <<~EOS
      <a href="/tags/#{tag[0]}" class="badge badge-secondary mr-2 mb-2">
        #{category_label(tag[0])} (#{tag[1].count})
      </a>
    EOS
  end

  def release_year_button(tag)
    <<~EOS
      <a href="/tags/#{tag[0]}" class="badge badge-secondary mr-2 mb-2">
        #{release_year_label(tag[0])} (#{tag[1].count})
      </a>
    EOS
  end

  def genre_button(tag)
    <<~EOS
      <a href="/tags/#{tag[0]}" class="badge badge-primary mr-2 mb-2">
        #{genre_label(tag[0])} (#{tag[1].count})
      </a>
    EOS
  end

  def artist_button(tag)
    <<~EOS
      <a href="/tags/#{tag[0]}" class="badge badge-success mr-2 mb-2">
        #{artist_label(tag[0])} (#{tag[1].count})
      </a>
    EOS
  end

  def breadcrump_crumps(site)
    x = -> (list) do
      list.select do |v|
        !v.data['title'].nil?
      end.map do |v|
        {
          'url'   => v.url.gsub(/\/index\.html/, ''),
          'title' => v.url.match(/^\/tags\//) ? tag_label(v.data['title']) : v.data['title'],
        }
      end
    end
    [
      x.call(site.pages),
      x.call(site.posts),
    ].flatten.sort{ |a, b| a['url'] <=> b['url'] }
  end

  def breadcrump_trails(page)
    trails = []
    crumps = breadcrump_trail(page['url']).split('/')
    crumps.count.times.each do |i|
      trails << "#{crumps.slice(0, i + 1).join('/')}"
    end
    trails
  end

  def breadcrump_trail(url)
    url.gsub(/\/index\.html/, '').gsub(/\/page\/[\d]+$/, '')
  end
end

Liquid::Template.register_filter(CustomFilter)
